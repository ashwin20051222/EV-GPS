<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EV-GPS Tracker</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { width: 100%; height: 90vh; }
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const API_URL = 'https://yolo-racer.infinityfree.me/getroute.php?limit=500';

  const map = L.map('map').setView([0, 0], 2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
  }).addTo(map);

  const route = L.polyline([], { color: 'blue', weight: 4 }).addTo(map);
  const liveMarker = L.marker([0, 0]).addTo(map);

  async function refresh() {
    try {
      const response = await fetch(API_URL, { cache: 'no-store' });
      const points = await response.json();
      if (!points.length) return;
      const latlngs = points.map(p => [p[0], p[1]]);
      route.setLatLngs(latlngs);
      const last = latlngs[latlngs.length - 1];
      liveMarker.setLatLng(last);
      map.setView(last, 15);
    } catch (err) {
      console.error('Fetch error:', err);
    }
  }

  refresh();
  setInterval(refresh, 5000);
</script>

</body>
</html>
